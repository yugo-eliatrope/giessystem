# üå± GiesSystem

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏–≤–æ–º –Ω–∞ –±–∞–∑–µ Arduino —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üå°Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (DHT11)
- üíß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º —á–µ—Ä–µ–∑ —Ä–µ–ª–µ
- üìä –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üìã –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

## –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Arduino

```
Arduino Uno/Nano
‚îú‚îÄ‚îÄ Pin 2  ‚Üí DHT11 (Data)
‚îú‚îÄ‚îÄ Pin 7  ‚Üí Relay Module (IN)
‚îú‚îÄ‚îÄ 5V     ‚Üí DHT11 (VCC), Relay (VCC)
‚îî‚îÄ‚îÄ GND    ‚Üí DHT11 (GND), Relay (GND)
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. Arduino

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `DHT sensor library` —á–µ—Ä–µ–∑ Arduino IDE
2. –û—Ç–∫—Ä–æ–π—Ç–µ `arduino/app.ino`
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫–µ—Ç—á –Ω–∞ –ø–ª–∞—Ç—É

### 2. –°–µ—Ä–≤–µ—Ä

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
yarn install

# –°–±–æ—Ä–∫–∞
yarn build
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
SERIAL_PORT_PATH=/dev/ttyUSB0
SERIAL_BAUD_RATE=9600
SERVER_PORT=3000
MAX_LOG_MESSAGES=100
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—É—Ç—å –∫ Serial –ø–æ—Ä—Ç—É –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°:
> - Linux: `/dev/ttyUSB0` –∏–ª–∏ `/dev/ttyACM0`
> - macOS: `/dev/cu.usbserial-*` –∏–ª–∏ `/dev/cu.usbmodem*`
> - Windows: `COM3`, `COM4`, –∏ —Ç.–¥.

### 4. –ó–∞–ø—É—Å–∫

```bash
# Production
yarn start

# Development
yarn dev
```

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000` –µ—Å–ª–∏ SERVER_PORT == 3000

## API

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/` | GET | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| `/info` | GET | JSON —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –∏ –ª–æ–≥–∞–º–∏ |
| `/pump?time=N` | GET | –í–∫–ª—é—á–∏—Ç—å –Ω–∞—Å–æ—Å –Ω–∞ N —Å–µ–∫—É–Ω–¥ (2-32) |

## –£–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –º–æ–∂–Ω–æ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ VPS –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ.

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤:

```bash
sudo nano /etc/ssh/sshd_config
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ/–¥–æ–±–∞–≤—å—Ç–µ:

```
AllowTcpForwarding yes
GatewayPorts yes
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ SSH:

```bash
sudo systemctl restart sshd
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ autossh

–ù–∞ –¥–æ–º–∞—à–Ω–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# Debian/Ubuntu
sudo apt install autossh

# macOS
brew install autossh
```

### 3. –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è

```bash
autossh -M 0 -N -R 0.0.0.0:3000:localhost:3000 user@VPS_IP
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `-M 0` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Ä—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ServerAliveInterval)
- `-N` ‚Äî –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±—Ä–æ—Å
- `-R 0.0.0.0:3000:localhost:3000` ‚Äî –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ 3000 VPS –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π 3000

### 4. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ (systemd)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/giessystem-tunnel.service`:

```ini
[Unit]
Description=GiesSystem SSH Tunnel
After=network.target

[Service]
User=YOUR_USER
ExecStart=/usr/bin/autossh -M 0 -N -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -R 0.0.0.0:3000:localhost:3000 user@VPS_IP
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ:

```bash
sudo systemctl enable giessystem-tunnel
sudo systemctl start giessystem-tunnel
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
giessystem/
‚îú‚îÄ‚îÄ arduino/
‚îÇ   ‚îî‚îÄ‚îÄ app.ino          # –°–∫–µ—Ç—á –¥–ª—è Arduino
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.ts        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îÇ   ‚îú‚îÄ‚îÄ server.ts        # HTTP —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ serial-manager.ts # –†–∞–±–æ—Ç–∞ —Å Serial –ø–æ—Ä—Ç–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ parser.ts        # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Arduino
‚îÇ   ‚îú‚îÄ‚îÄ store.ts         # –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ index.html       # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ dist/                # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JS —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ package.json
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC

